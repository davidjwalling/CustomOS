### Project os.002
Source: [os.002/os.asm](../os.002/os.asm)

### Features and Topics
- BIOS Diskette Read and Write Sectors
- FAT-12 and Diskette Directory Structure

### [Virtual](VIRTUAL.md) Machine Operation
- Start a VirtualBox VM configured to boot from os.dsk, emulating a 3.5" 1.44MB floppy diskette following these [steps](VIRTUAL.md).
- The boot (first) sector of the diskette image is loaded to real mode address 0x7C00 and executed.
- The boot sector displays a message, "Loading OS".
- The boot sector then searches the diskette, or image file, for the <span>os.com</span> program.
- If <span>os.com</span> is not found, an error messages is displayed.
- If <span>os.com</span> is found, it is loaded into memory and control is passed to it.
- The <span>os.com</span> program displays a message, "Starting OS".
- Upon a key press, the system restarts.

<img src="../images/os002_VirtualBox_001.PNG" width="640"/>

### [Physical](PHYSICAL.md) Machine Operation
- Prepare a physical 3.5" 1.44 MB diskette with os.002/os.dat as the boot sector following steps similar to [these](PHYSICAL.md).
- Note: Copy os.002/os.dat to the diskette boot sector instead of os.001/os.dat.
- Copy os.002/os.com onto the physical diskette.
- Insert the prepared diskette into a 3.5" floppy disk drive configured as Drive A:.
- Start the system.

<img src="../images/os002_Boot_001.jpg"/>

### Notes

The program introduces the BUILDCOM directive to create the OS kernel program, <span>os.com</span>. BUILDCOM is enabled automatically if the directive BUILDDISK is defined.

<img src="../images/os002_listing_001.PNG"/>

Project os.002 uses the BIOS diskette I/O functions to read the file <span>os.com</span> from the diskette image in virtual environments or from an actual diskette in physical environments.

<img src="../images/os002_listing_165.PNG"/>

During the loading phase, one copy of the file allocation table and a sector of the diskette directory will be read into memory after the boot sector.

<img src="../images/os002_listing_186.PNG"/>

The diskette image file os.dsk is expanded to include the standard two copies of the file allocation table (FAT), the diskette directory and the <span>os.com</span> program. The boot sector is expanded to search the diskette directory to find, load and run <span>os.com</span>. Each sector of the diskette directory is read and searched until the directory entry for the <span>os.com</span> loader file is found. This entry will identify the starting disk cluster of the <span>os.com</span> program and the length of the <span>os.com</span> program. The <span>os.com</span> program is then loaded into memory and control is transferred to the <span>os.com</span> program's code segment.


<img src="../images/os002_listing_243.PNG"/>

<img src="../images/os002_listing_291.PNG"/>

<img src="../images/os002_listing_346.PNG"/>

<img src="../images/os002_listing_399.PNG"/>

<img src="../images/os002_listing_448.PNG"/>

<img src="../images/os002_listing_501.PNG"/>

<img src="../images/os002_listing_555.PNG"/>

<img src="../images/os002_listing_609.PNG"/>

<img src="../images/os002_listing_641.PNG"/>

<img src="../images/os002_listing_691.PNG"/>





