<console>
wdConsoleField - the active field

<panel>
handler        :4

<field>
buffer address 0:4    32-bit addr
row            4:1    0-23
column         5:1    0-79
size           6:1    0-255
cursor index   7:1    0-255
first selected 5:1    0-255
last selected  6:1    0-255
attribute      10:1   bg/fg color
flags          11:1   0x80 = is input
				 	  0x40 = is active


[write field to video memory]
compute field memory offset address
set attribute to field attribute
if field is active field
  set attribute to active field attribute
end if
write field contents with attribute to video memory
if field content is selected
  write selected content with selected attribute to video memory
end if
return

[add field position to selection]

[handle keypress]
    if back-arrow or up-arrow
      if field index > 0
	    decrement field index
		if shift-key is down
  		  do add field position to selection
		  do write field to video memory
		end if
	  end if
    else if forward-arrow or down-arrow
	  if field index < field max index
		if shift-key is down
		  do add field position to selection
		  do write field to video memory
		end if
	    increment field index
      end if
    else if backspace
	  if field positions are selected
	    remove selected characters from field bufer
		set first selected position to zero
		set last selected position to zero
		do write field video to memory
	  else if field index > 0
	    decrement field index
  	    remove character in field buffer at field index
		do write field to video memory
	  end if
    else if backtab
	  set active field to prior field
    else if tab
	  set active field to next field
    else if enter or escape or PF key
	  do panel submit routine
    else if printable
	  if insert mode is on
	    if field is not full
		  shift field characters at field index right 1 position
		  set field character at field index to keypress
		  do write field to video memory
		end if
	  else
	    set field character at field index to keypress
	  end if
    else
    end if


[ConCode]
Initialize work areas to low values
  insert mode is on
  cursor position is 0,0
  active field is not set
  field index is zero
Initialize the OIA
Set cursor size to insert-mode cursor size
Set the current panel to main
do
  if there is no active field
    find the first input field
	set active field to the first input field
  end if
  clear the console video memory rows
  set the current field to the first panel field
  while not end-of-panel
    do write field to video memory
	address the next panel field
  end while
  do
    set current position as field origin plus field index
    place cursor at the current position
    get keypress
	do handle keypress
  while keypress not attention identifier
while true

[add field position to selection]
if field position <= first selected position
  set first selected position to field position
if field position >= last selected position
  set last selected position to field position
return